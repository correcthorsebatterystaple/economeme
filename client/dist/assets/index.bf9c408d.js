var U=Object.defineProperty,V=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var y=(n,e,t)=>e in n?U(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,C=(n,e)=>{for(var t in e||(e={}))H.call(e,t)&&y(n,t,e[t]);if(k)for(var t of k(e))J.call(e,t)&&y(n,t,e[t]);return n},j=(n,e)=>V(n,F(e));var p=(n,e,t)=>(y(n,typeof e!="symbol"?e+"":e,t),t);import{r as d,j as r,M as K,a as s,B as q,T as G,b as v,c as Y,d as z,e as Q,f as B,g as u,h as W,I as X,i as Z,R as _,k as ee}from"./vendor.d9b5a3ff.js";const te=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))h(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function h(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};te();var re="/assets/fidget-spinner.a9c878ad.gif";const b=class{constructor(){}static getInstance(){return b.instance?b.instance:new b}async getRandomPost(e="",t="",h=""){const o=`subreddit=${e}&listing=${t}&period=${h}`;return await fetch("/api/posts/random?"+o).then(i=>i.json())}async getPost(e){return await fetch("/api/posts?permalink="+e).then(t=>t.json())}};let S=b;p(S,"instance");const g=class{constructor(e){p(this,"portfolio",[]);p(this,"balance",1e3);this.apiService=e}static getInstance(e){return g.instance?g.instance:new g(e)}buy(e){return this.balance>=e.buyPrice?(this.portfolio=[e,...this.portfolio],this.balance-=e.buyPrice,!0):!1}sell(e){const t=this.findPostIndex(e);t!==-1&&(this.balance+=this.portfolio[t].price,this.portfolio=[...this.portfolio.slice(0,t),...this.portfolio.slice(t+1)])}async refresh(){this.portfolio=await Promise.all(this.portfolio.map(async e=>{const t=await this.apiService.getPost(e.permalink);return j(C({},e),{price:t.price})}))}has(e){return this.findPostIndex(e)!==-1}findPostIndex(e){return this.portfolio.findIndex(t=>t.permalink===e.permalink)}};let P=g;p(P,"instance");const x=class{constructor(e){this.portfolioService=e}static getInstance(e){return x.instance?x.instance:new x(e)}save(){const e={portfolio:this.portfolioService.portfolio,balance:this.portfolioService.balance};localStorage.setItem("meme",JSON.stringify(e))}load(){const e=JSON.parse(localStorage.getItem("meme")||"null");!e||(this.portfolioService.portfolio=e.portfolio,this.portfolioService.balance=e.balance)}};let w=x;p(w,"instance");const ne={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function oe(n){const[e,t]=d.exports.useState("");return r("div",{children:r(K,{open:n.open,onClose:n.onClose,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:s(q,{sx:ne,children:[r(G,{id:"modal-modal-title",variant:"h6",component:"h2",children:"Select your own post"}),r("input",{type:"text",placeholder:"Enter Permalink Here",onChange:h=>t(h.target.value)}),r(v,{onClick:()=>n.onSubmit(e),children:"Submit"})]})})})}const N=S.getInstance(),l=P.getInstance(N),M=w.getInstance(l);M.load();function O(n,e){return Math.round((n/e-1)*100)}function ae(){const[n,e]=d.exports.useState(!0),[t,h]=d.exports.useState(null),[o,i]=d.exports.useState(l.portfolio),[f,I]=d.exports.useState(l.portfolio.map(a=>a.price));d.exports.useEffect(()=>{I(o.map(a=>a.price))},[o]),d.exports.useEffect(()=>{m();const a=setInterval(()=>{l.refresh().then(()=>I(l.portfolio.map(c=>c.price)))},3e3);return()=>clearInterval(a)},[]),d.exports.useEffect(()=>{M.save()},[o]);const m=()=>{e(!0),N.getRandomPost().then(a=>{if(l.has(a)){m();return}h(a)}).then(()=>e(!1))},T=a=>{N.getPost(a).then(c=>c&&h(c))},L=()=>{n||l.buy(t)&&(i(l.portfolio),m())},R=a=>{l.sell(o[a]),i(l.portfolio)},[$,E]=d.exports.useState(!1),A=()=>E(!1),D=a=>{if(!a){m();return}T(a)};return s("div",{className:"grid grid-cols-2",children:[s("div",{className:"h-screen flex flex-col justify-between border-r border-black",children:[r("div",{className:"flex justify-between gap-x-4 h-8 border-b border-black",children:n?r("h2",{className:"text-center w-full",children:"Loading..."}):s(d.exports.Fragment,{children:[s("h2",{children:["r/",t.subreddit]}),r("h2",{title:t.title,className:"text-lg text-center truncate",children:r("a",{href:"https://reddit.com"+t.permalink,target:"blank",className:"text-blue-600 underline",children:t.title})}),r("h2",{children:new Date(t.createdAt).toLocaleDateString("en-GB")})]})}),r("div",{className:"h-4/5 overflow-y-auto flex align-center",children:r("img",{src:n?re:t.imgUrl,alt:"Meme",className:"m-auto"})}),s("p",{className:"text-center text-4xl",children:["$ ",n?"???":t.buyPrice]}),s("div",{className:"flex justify-around w-full",children:[r(v,{onClick:()=>L(),color:"success",variant:"contained",sx:{width:"50%",borderRadius:"0"},children:"BUY"}),r(v,{onClick:()=>m(),sx:{width:"50%"},children:"SKIP"})]})]}),s("div",{className:"h-screen relative",children:[r("h2",{className:"text-2xl text-center",children:"Portfolio"}),r(Y,{className:"h-4/5 overflow-auto",children:s(z,{children:[r(Q,{children:s(B,{children:[r(u,{children:"Preview"}),r(u,{children:"Title"}),r(u,{children:"Value"}),r(u,{children:"Change"})]})}),r(W,{children:o.map((a,c)=>s(B,{children:[r(u,{children:r("a",{href:`https://reddit.com${a.permalink}`,target:"blank",children:r("img",{src:a.imgUrl,alt:"preview",className:"m-auto h-8"})})}),r(u,{children:a.title}),r(u,{children:f[c]}),r(u,{children:s("div",{className:"flex gap-2 justify-around",children:[s("span",{className:(O(f[c],a.buyPrice)>0?"text-green-600":"text-red-600")+" pt-2",children:[O(f[c],a.buyPrice),"%"]}),r(X,{color:"error",onClick:()=>R(c),children:r(Z,{})})]})})]},c))})]})}),s("div",{className:"w-full text-center absolute bottom-4 flex justify-around",children:[s("h2",{className:"text-4xl",children:["Value:\xA0",s("span",{className:"text-green-600",children:["$ ",l.portfolio.reduce((a,c)=>a+c.price,0)+l.balance]})]}),s("h2",{className:"text-4xl",children:["Balance: $ ",l.balance]})]})]}),r(oe,{open:$,onClose:A,onSubmit:D})]})}_.render(r(ee.StrictMode,{children:r(ae,{})}),document.getElementById("root"));
