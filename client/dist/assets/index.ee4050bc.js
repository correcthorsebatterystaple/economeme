var U=Object.defineProperty,V=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var v=(o,e,t)=>e in o?U(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,C=(o,e)=>{for(var t in e||(e={}))H.call(e,t)&&v(o,t,e[t]);if(k)for(var t of k(e))J.call(e,t)&&v(o,t,e[t]);return o},j=(o,e)=>V(o,F(e));var p=(o,e,t)=>(v(o,typeof e!="symbol"?e+"":e,t),t);import{r as d,j as r,M as K,a as i,B as q,T as G,b as S,c as Y,d as z,e as Q,f as B,g as u,h as W,I as X,i as Z,R as _,k as ee}from"./vendor.d9b5a3ff.js";const te=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}};te();var re="/assets/fidget-spinner.a9c878ad.gif";const b=class{constructor(){}static getInstance(){return b.instance?b.instance:new b}async getRandomPost(e="",t="",h=""){const n=`subreddit=${e}&listing=${t}&period=${h}`;return await fetch("/api/posts/random?"+n).then(s=>s.json())}async getPost(e){return await fetch("/api/posts?permalink="+e).then(t=>t.json())}};let P=b;p(P,"instance");const g=class{constructor(e){p(this,"portfolio",[]);p(this,"balance",1e3);this.apiService=e}static getInstance(e){return g.instance?g.instance:new g(e)}buy(e){return this.balance>=e.buyPrice?(this.portfolio=[e,...this.portfolio],this.balance-=e.buyPrice,!0):!1}sell(e){const t=this.findPostIndex(e);t!==-1&&(this.balance+=this.portfolio[t].price,this.portfolio=[...this.portfolio.slice(0,t),...this.portfolio.slice(t+1)])}async refresh(){this.portfolio=await Promise.all(this.portfolio.map(async e=>{const t=await this.apiService.getPost(e.permalink);return j(C({},e),{price:t.price})}))}has(e){return this.findPostIndex(e)!==-1}findPostIndex(e){return this.portfolio.findIndex(t=>t.permalink===e.permalink)}};let w=g;p(w,"instance");const x=class{constructor(e){this.portfolioService=e}static getInstance(e){return x.instance?x.instance:new x(e)}save(){const e={portfolio:this.portfolioService.portfolio,balance:this.portfolioService.balance};localStorage.setItem("meme",JSON.stringify(e))}load(){const e=JSON.parse(localStorage.getItem("meme")||"null");!e||(this.portfolioService.portfolio=e.portfolio,this.portfolioService.balance=e.balance)}};let N=x;p(N,"instance");const oe={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function ne(o){const[e,t]=d.exports.useState("");return r("div",{children:r(K,{open:o.open,onClose:o.onClose,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:i(q,{sx:oe,children:[r(G,{id:"modal-modal-title",variant:"h6",component:"h2",children:"Select your own post"}),r("input",{type:"text",placeholder:"Enter Permalink Here",onChange:h=>t(h.target.value)}),r(S,{onClick:()=>o.onSubmit(e),children:"Submit"})]})})})}const I=P.getInstance(),c=w.getInstance(I),M=N.getInstance(c);M.load();function O(o,e){return Math.round((o/e-1)*100)}function ae(){const[o,e]=d.exports.useState(!0),[t,h]=d.exports.useState(null),[n,s]=d.exports.useState(c.portfolio),[f,y]=d.exports.useState(c.portfolio.map(a=>a.price));d.exports.useEffect(()=>{y(n.map(a=>a.price))},[n]),d.exports.useEffect(()=>{m();const a=setInterval(()=>{c.refresh().then(()=>y(c.portfolio.map(l=>l.price)))},3e3);return()=>clearInterval(a)},[]),d.exports.useEffect(()=>{M.save()},[n]);const m=()=>{e(!0),I.getRandomPost().then(a=>{if(c.has(a)){m();return}h(a)}).then(()=>e(!1))},T=a=>{I.getPost(a).then(l=>l&&h(l))},L=()=>{o||c.buy(t)&&(s(c.portfolio),m())},R=a=>{c.sell(n[a]),s(c.portfolio),y(c.portfolio.map(l=>l.price))},[$,E]=d.exports.useState(!1),A=()=>E(!1),D=a=>{if(!a){m();return}T(a)};return i("div",{className:"grid grid-cols-2",children:[i("div",{className:"h-screen flex flex-col justify-between border-r border-black",children:[r("div",{className:"flex justify-between gap-x-4 h-8 border-b border-black",children:o?r("h2",{className:"text-center w-full",children:"Loading..."}):i(d.exports.Fragment,{children:[i("h2",{children:["r/",t.subreddit]}),r("h2",{title:t.title,className:"text-lg text-center truncate",children:r("a",{href:"https://reddit.com"+t.permalink,target:"blank",className:"text-blue-600 underline",children:t.title})}),r("h2",{children:new Date(t.createdAt).toLocaleDateString("en-GB")})]})}),r("div",{className:"h-4/5 overflow-y-auto flex align-center",children:r("img",{src:o?re:t.imgUrl,alt:"Meme",className:"m-auto"})}),i("p",{className:"text-center text-4xl",children:["$ ",o?"???":t.buyPrice]}),i("div",{className:"flex justify-around w-full",children:[r(S,{onClick:()=>L(),color:"success",variant:"contained",sx:{width:"50%",borderRadius:"0"},children:"BUY"}),r(S,{onClick:()=>m(),sx:{width:"50%"},children:"SKIP"})]})]}),i("div",{className:"h-screen relative",children:[r("h2",{className:"text-2xl text-center",children:"Portfolio"}),r(Y,{className:"h-4/5 overflow-auto",children:i(z,{children:[r(Q,{children:i(B,{children:[r(u,{children:"Preview"}),r(u,{children:"Title"}),r(u,{children:"Value"}),r(u,{children:"Change"})]})}),r(W,{children:n.map((a,l)=>i(B,{children:[r(u,{children:r("a",{href:`https://reddit.com${a.permalink}`,target:"blank",children:r("img",{src:a.imgUrl,alt:"preview",className:"m-auto h-8"})})}),r(u,{children:a.title}),r(u,{children:f[l]}),r(u,{children:i("div",{className:"flex gap-2 justify-around",children:[i("span",{className:(O(f[l],a.buyPrice)>0?"text-green-600":"text-red-600")+" pt-2",children:[O(f[l],a.buyPrice),"%"]}),r(X,{color:"error",onClick:()=>R(l),children:r(Z,{})})]})})]},l))})]})}),i("div",{className:"w-full text-center absolute bottom-4 flex justify-around",children:[i("h2",{className:"text-4xl",children:["Value:\xA0",i("span",{className:"text-green-600",children:["$ ",c.portfolio.reduce((a,l)=>a+l.price,0)+c.balance]})]}),i("h2",{className:"text-4xl",children:["Balance: $ ",c.balance]})]})]}),r(ne,{open:$,onClose:A,onSubmit:D})]})}_.render(r(ee.StrictMode,{children:r(ae,{})}),document.getElementById("root"));
